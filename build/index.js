"use strict";function B(e,t,n,r,c,a,o){try{var i=e[a](o),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,c)}function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,c,a=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){i=!0,c=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw c}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}window.onload=function(){function r(e){0<(i=Object.values(o).reduce(function(e,t){return e+t.currentCount},0))&&(e.classList.add("with-products"),d.innerHTML=99<i?"99+":i)}function c(e,t){e&&t?n(e,t):f.forEach(function(e){n(e,o[e.id].currentCount)})}function n(e,t){0<t&&(e.innerHTML="в корзине: ".concat(t)),0===t&&(e.innerHTML="купить")}function a(){for(var e in o)localStorage.setItem(e,JSON.stringify(o[e]));t()}function t(){for(var e in u=0,localStorage)localStorage.hasOwnProperty(e)&&(e=JSON.parse(localStorage[e]),u+=e.weight*e.price*e.currentCount);k.innerHTML=0<u?"Оформить заказ: ".concat(u,"₽"):"Оформить заказ"}var e,o={wrap1:{name:"Стрейч-пленка первичная, ручная",price:230,weight:2,currentCount:0},wrap2:{name:"Стрейч-пленка вторичная, ручная",price:175,weight:2,currentCount:0},wrap3:{name:"Стрейч-пленка первичная, машинная",price:220,weight:16,currentCount:0},wrap4:{name:"Техническая пленка ПВД",price:120,weight:27.6,currentCount:0}},i=0,u=0,l=document.getElementById("basket"),d=document.getElementById("basket-count"),s=document.getElementById("menu"),m=document.querySelector("body"),v=document.querySelectorAll(".menu-item"),f=document.querySelectorAll(".card__btn");for(e in localStorage)localStorage.hasOwnProperty(e)&&(o[e].currentCount=JSON.parse(localStorage[e]).currentCount,c(document.getElementById("btn-".concat(e)),o[e].currentCount));r(l);function p(){s.classList.toggle("opened"),m.classList.toggle("active")}s.addEventListener("click",p),v.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),p(),document.getElementById(e.target.dataset.scroll).scrollIntoView({behavior:"smooth",block:"start"})})}),f.forEach(function(e,n){return e.addEventListener("click",function(e){var t=o["wrap".concat(n+1)];t.currentCount++,i++,a(),c(e.target,t.currentCount),r(l)})});function y(){document.getElementById("basket-content").innerHTML=Object.entries(o).reduce(function(e,t){var n=A(t,2),t=n[0],n=n[1];return n.currentCount<1?e+"":e+' <div class="basket-card">\n                            <div class="basket-card__content">\n                                <img src=\'img/'.concat(t,".jpg' alt='").concat(n.name,'\' class="basket-card__img">\n                                <div class="basket-card__inner">\n                                    <div class="basket-card__name">').concat(n.name,'</div>\n                                    <div class="basket-card__range-block">\n                                        <div class="basket-card__input">\n                                            <button class="decr">-</button>\n                                            <input type="text" data-key=\'').concat(t,'\' min="1" maxlength="3" autocomplete="off" readonly value=\'').concat(n.currentCount,'\'>\n                                            <button class="incr">+</button>\n                                        </div>\n                                        <div class="basket-card__price" data-key=\'').concat(t,"'>").concat(n.weight*n.price*n.currentCount,'₽</div>\n                                    </div>\n                                </div>\n                            </div>\n                            <button class="basket-card__delete" data-key=\'').concat(t,"'>×</button>\n                        </div> ")},"")}function g(e){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e.forEach(function(e){var t=e.parentNode.querySelector("input");e.addEventListener("click",function(){if(n)t.value=Number(t.value)+1;else{if(1===Number(t.value))return void document.querySelector('.basket-card__delete[data-key="'.concat(t.dataset.key,'"]')).dispatchEvent(new Event("click"));t.value=Number(t.value)-1}o[t.dataset.key].currentCount=Number(t.value),a(),c(),r(l),function(e,t){e=document.querySelector('.basket-card__price[data-key="'.concat(e,'"]'));e&&(t=t.weight*t.price*t.currentCount,e.innerHTML=t+"₽")}(t.dataset.key,o[t.dataset.key])})})}var b=document.getElementById("modal-basket"),h=document.getElementById("basket-modal-close"),k=document.getElementById("btn-order");l.addEventListener("click",function(){var e,t;0<i?(y(),e=document.querySelectorAll(".decr"),t=document.querySelectorAll(".incr"),document.querySelectorAll(".basket-card__delete").forEach(function(e){e.addEventListener("click",function(){o[e.dataset.key].currentCount=0,a(),c(),r(l),y()})}),g(e),g(t,!0)):(b.classList.toggle("empty-basket"),k.disabled=!0,b.querySelector(".modal-title").innerHTML="Корзина пуста"),m.classList.add("open-modal"),b.classList.toggle("visible")}),b.addEventListener("click",function(e){e=e.target;e!==b&&e!==h&&e!==k||(e!==k&&m.classList.remove("open-modal"),b.classList.toggle("visible"),b.classList.remove("empty-basket"),k.disabled=!1,b.querySelector(".modal-title").innerHTML="Корзина")});var E=document.getElementById("modal-order"),L=document.getElementById("order-modal-close"),_=document.getElementById("hidden-products"),S=document.getElementById("order-products-wrapper");k.addEventListener("click",function(){var r;Object.values(o).reduce(function(e,t){return e+t.currentCount},0)<1?alert("Для заказа добавьте хотя бы один товар в корзину."):(E.classList.toggle("visible"),_.value="",S.innerHTML="",r=0,Object.entries(o).forEach(function(e){var t=A(e,2),n=t[0],e=t[1];0<e.currentCount&&(t=e.price*e.currentCount*e.weight,r+=t,_.value+="Товар: ".concat(e.name,"; Кол-во: ").concat(e.currentCount," шт.;Сумма: ").concat(t,"руб.;\n         "),S.innerHTML+='\n          <div class="order-card">\n              <img src="img/'.concat(n,'.jpg" alt="').concat(e.name,'" class="order-card__img">\n              <div class="order-card__text-wrapper">\n                  <p class="order-card__product-name">').concat(e.name,'</p>\n                  <div class="order-card__summary">\n                      <p class="order-card__amount">Кол-во: <span>').concat(e.currentCount,'</span></p>\n                      <p class="order-card__price">').concat(t," ₽</p>\n                  </div>\n              </div>\n          </div>\n        ")),document.querySelector(".group-summary__cost").innerHTML="".concat(r," ₽"),document.getElementById("total-cost").value="".concat(r," ₽")}))}),E.addEventListener("click",function(e){e=e.target;e!==E&&e!==L||(E.classList.toggle("visible"),m.classList.remove("open-modal"))});var w=document.getElementById("my-form"),C=document.getElementById("my-form-button");function I(){var i;return i=regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),C.disabled=!0,n=new FormData(t.target),fetch(t.target.action,{method:w.method,body:n,headers:{Accept:"application/json"}}).then(function(e){C.innerHTML="Спасибо за заказ!",w.reset(),localStorage.clear()}).catch(function(e){C.innerHTML="Что-то пошло не так."}).finally(function(){C.disabled=!1,q.dispatchEvent(new Event("change"))});case 4:case"end":return e.stop()}},e)}),(I=function(){var e=this,o=arguments;return new Promise(function(t,n){var r=i.apply(e,o);function c(e){B(r,t,n,c,a,"next",e)}function a(e){B(r,t,n,c,a,"throw",e)}c(void 0)})}).apply(this,arguments)}w.addEventListener("submit",function(e){return I.apply(this,arguments)});var q=document.getElementById("receipt");q.addEventListener("change",function(e){var t=e.target.value,n=document.querySelectorAll(".receipt-pickup"),e=document.querySelectorAll(".receipt-delivery"),t="Самовывоз"===t;(t?e:n).forEach(function(e){return e.classList.add("hidden")}),(t?n:e).forEach(function(e){return e.classList.remove("hidden")});e=document.querySelector(".receipt-delivery");e.querySelector("input").required=!t,t?e.querySelector("label").classList.remove("required"):e.querySelector("label").classList.add("required")}),q.dispatchEvent(new Event("change")),document.getElementById("agree").addEventListener("click",function(e){C.disabled=!e.target.checked})};